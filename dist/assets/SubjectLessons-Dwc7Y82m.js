import{j as e}from"./ui-BFkRrjhf.js";import{j as s,i as t,h as a,r}from"./vendor-ClsjX3Mm.js";import{a as l,B as n}from"./index-CgruMJ9X.js";import{S as o,g as i}from"./StudentHeader-BEY8Ekm7.js";import{B as c}from"./badge-CO1u2g-4.js";import{C as d,a as m}from"./card-COhXL4y3.js";import{I as x}from"./input-K7STGv4F.js";import{P as h}from"./progress-BCMZ4yGb.js";import{getLessonsBySubjectAndGrade as p}from"./lessons-BDW73QPv.js";import{c as u,g as j}from"./enrollments-ZADooVCN.js";import{a3 as g,_ as f,J as N,$ as b,l as v,u as w,B as y}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./separator-D-EoJ3Ty.js";import"./select-BhEU0EIQ.js";import"./scroll-area-DkFg0wM_.js";import"./formatDistanceToNow-Bf1kdoXg.js";import"./siteConfig-BOV2ERHg.js";const C=()=>{const{grade:C,subject:k}=s(),[S]=t(),{user:$,loading:B}=l(),L=a(),[U,I]=r.useState(""),[P,A]=r.useState([]),[G,T]=r.useState([]),[D,E]=r.useState(!0),[H,_]=r.useState(""),[J,M]=r.useState(!1),[O,Q]=r.useState(!0),R=S.get("term"),X=S.get("grade")||C,Y=k?k.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"";r.useEffect(()=>{B||$||L("/auth")},[$,B,L]),r.useEffect(()=>{(async()=>{if($&&X&&Y)try{Q(!0);const e=R?R.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):void 0,s=await u(Y,X,e);M(s.hasAccess);const t=await i($.id);t&&I(t.fullName);const a=await p(Y,X,e),r=await j($.id);A(a.map(e=>({id:e.id,title:e.title,description:e.description}))),T(r.map(e=>({lessonId:e.lessonId,completed:e.completed})))}catch(e){}finally{E(!1),Q(!1)}})()},[$,X,Y,R]);const Z=e=>G.some(s=>s.lessonId===e&&s.completed);if(B||D||O)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(o,{studentName:U}),e.jsx("div",{className:"pt-24 container mx-auto px-4 flex items-center justify-center",style:{minHeight:"calc(100vh - 96px)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Loading lessons…"})]})})]});if(!J)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(o,{studentName:U}),e.jsxs("main",{className:"pt-24 pb-16 container mx-auto px-4",children:[e.jsxs(n,{variant:"ghost",onClick:()=>L("/browse"),className:"gap-2 mb-6",children:[e.jsx(g,{className:"w-4 h-4"}),"Back to Browse"]}),e.jsx(d,{className:"max-w-2xl mx-auto",children:e.jsxs(m,{className:"py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"w-8 h-8 text-purple-600 dark:text-purple-300"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Course Not Purchased"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"You need to purchase this course to access its lessons."}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:Y}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Grade ",X,R?` • ${R.split("-").map(e=>{var s;return(null==(s=e[0])?void 0:s.toUpperCase())+e.slice(1)}).join(" ")}`:""]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(n,{onClick:()=>L("/browse"),variant:"outline",children:"Browse Courses"}),e.jsxs(n,{onClick:()=>L("/cart"),className:"gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Go to Cart"]})]})]})})]})]});const q=P.filter(e=>Z(e.id)).length,z=P.length>0?Math.round(q/P.length*100):0;return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(o,{studentName:U}),e.jsxs("main",{className:"pt-24 pb-16 container mx-auto px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(n,{variant:"ghost",onClick:()=>{L(R&&X?`/grade/${X}/term/${R}`:"/dashboard")},className:"gap-2 mb-4",children:[e.jsx(g,{className:"w-4 h-4"}),"Back ",R?"to Term":"to Dashboard"]}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:Y}),e.jsxs("p",{className:"text-muted-foreground",children:["Grade ",X,R?` • ${R.split("-").map(e=>{var s;return(null==(s=e[0])?void 0:s.toUpperCase())+e.slice(1)}).join(" ")}`:""]})]}),P.length>0&&e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[q,"/",P.length]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[z,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Progress"})]})]})]}),P.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(h,{value:z,className:"h-3"})})]}),e.jsx("div",{className:"mb-6 max-w-md",children:e.jsx(x,{placeholder:"Search lessons...",value:H,onChange:e=>_(e.target.value)})}),e.jsxs("div",{className:"space-y-3",children:[P.filter(e=>!H||e.title.toLowerCase().includes(H.toLowerCase())||(e.description||"").toLowerCase().includes(H.toLowerCase())).map((s,t)=>{const a=Z(s.id);return e.jsx(d,{className:"group hover:shadow-md transition-all cursor-pointer",onClick:()=>L(`/grade/${X}/${k}/lesson/${s.id}`),children:e.jsxs("div",{className:"flex items-center gap-4 p-5",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm "+(a?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-800 text-muted-foreground"),children:a?e.jsx(b,{className:"w-5 h-5"}):t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base group-hover:text-purple-600 transition-colors mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description})]}),a?e.jsxs(c,{variant:"secondary",className:"gap-1 flex-shrink-0",children:[e.jsx(v,{className:"w-3 h-3"})," Completed"]}):e.jsx(w,{className:"w-6 h-6 text-purple-600 flex-shrink-0"})]})},s.id)}),0===P.length&&e.jsx(d,{children:e.jsxs(m,{className:"py-16 text-center",children:[e.jsx(y,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-base text-muted-foreground font-semibold mb-1",children:"No lessons available"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check back soon for new content."})]})}),P.length>0&&0===P.filter(e=>!H||e.title.toLowerCase().includes(H.toLowerCase())).length&&e.jsx(d,{children:e.jsxs(m,{className:"py-16 text-center",children:[e.jsx("p",{className:"text-base text-muted-foreground font-semibold mb-1",children:"No lessons found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Try a different search term."})]})})]})]})]})};export{C as default};
