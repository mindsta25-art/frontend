import{j as e}from"./ui-BFkRrjhf.js";import{r as s,h as t}from"./vendor-ClsjX3Mm.js";import{S as a,g as r}from"./StudentHeader-BEY8Ekm7.js";import{W as l}from"./WhatsAppButton-C771FwVp.js";import{a as i,d as n,B as c}from"./index-CgruMJ9X.js";import{C as o,a as d}from"./card-COhXL4y3.js";import{S as m}from"./separator-D-EoJ3Ty.js";import{getSubjectsByGrade as x}from"./lessons-BDW73QPv.js";import{i as u}from"./payments-DtzS6FH2.js";import{a3 as p,B as j,f as h}from"./icons-Udnp6KR8.js";import"./input-K7STGv4F.js";import"./badge-CO1u2g-4.js";import"./select-BhEU0EIQ.js";import"./scroll-area-DkFg0wM_.js";import"./formatDistanceToNow-Bf1kdoXg.js";import"./siteConfig-BOV2ERHg.js";import"./charts-DeubIqjP.js";const f=()=>{const{user:f,loading:g}=i(),{cart:b,cartCount:N,loading:v,removeFromCart:y}=n(),[w,C]=s.useState(""),[S,k]=s.useState([]),[P,B]=s.useState(!1),L=t();s.useEffect(()=>{g||f||L("/auth")},[f,g,L]),s.useEffect(()=>{(async()=>{if(f)try{const e=await r(f.id);e&&C(e.fullName)}catch(e){}})()},[f]),s.useEffect(()=>{(async()=>{if((null==b?void 0:b.items)&&0!==b.items.length){B(!0);try{const e=await Promise.all(b.items.map(async e=>{try{const s=(await x(e.grade,e.term)).find(s=>s.name===e.subject);return{...e,price:(null==s?void 0:s.price)||0,lessonCount:(null==s?void 0:s.lessonCount)||0,rating:(null==s?void 0:s.rating)||0,enrolledStudents:(null==s?void 0:s.enrolledStudents)||0,duration:(null==s?void 0:s.duration)||0}}catch(s){return e}}));k(e)}catch(e){k(b.items)}finally{B(!1)}}else k([])})()},[null==b?void 0:b.items]);const z=!b||0===b.items.length,D=S.reduce((e,s)=>e+s.price,0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(a,{studentName:w}),e.jsx("main",{className:"pt-24 pb-16 container mx-auto px-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(c,{variant:"ghost",onClick:()=>L(-1),className:"gap-2",children:[e.jsx(p,{className:"w-4 h-4"})," Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Checkout"}),e.jsx("div",{})]}),z?e.jsxs(o,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty."}),e.jsx(c,{onClick:()=>L("/dashboard"),children:"Continue Shopping"})]}):e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(o,{children:e.jsxs(d,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Details"}),e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsxs("div",{className:"flex gap-4 pb-4 border-b last:border-b-0",children:[e.jsx("div",{className:"w-24 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded flex-shrink-0 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-base mb-1",children:s.subject}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Grade ",s.grade,s.term&&` • ${s.term}`]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[s.rating>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3 fill-orange-400 text-orange-400"}),s.rating.toFixed(1)]}),s.lessonCount>0&&e.jsxs("span",{children:["• ",s.lessonCount," lessons"]}),s.duration>0&&e.jsxs("span",{children:["• ",Math.ceil(s.duration/60),"h"]})]})]}),e.jsxs("div",{className:"font-bold text-base text-purple-600",children:["₦",s.price.toLocaleString()]})]},s._id))})]})})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(o,{className:"lg:sticky lg:top-24",children:e.jsxs(d,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Summary"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Original Price:"}),e.jsxs("span",{className:"font-semibold",children:["₦",D.toLocaleString()]})]}),e.jsx(m,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-purple-600",children:["₦",D.toLocaleString()]})]})]}),e.jsx(c,{size:"lg",className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold",onClick:async()=>{try{const e=D;if(e<=0||0===S.length)return;const s=S.map(e=>({subject:e.subject,grade:e.grade,term:e.term||void 0,price:e.price})),{authorizationUrl:t}=await u(e,s,`${window.location.origin}/payment/callback`);window.location.href=t}catch(e){alert(`Payment initialization failed: ${e.message||"Please try again"}`)}},disabled:D<=0||0===S.length||P,children:P?"Loading...":"Complete Checkout"}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-center text-muted-foreground mb-3",children:"Secure payment powered by Paystack"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"30-Day Money-Back Guarantee"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"Lifetime Access"})]})]})]})})})]})]})}),e.jsx(l,{})]})};export{f as default};
