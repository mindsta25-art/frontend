import{j as e}from"./ui-BFkRrjhf.js";import{r as s}from"./vendor-ClsjX3Mm.js";import{C as r,b as a,c as l,a as t,d}from"./card-COhXL4y3.js";import{B as i}from"./badge-CO1u2g-4.js";import{u as n,B as c}from"./index-CgruMJ9X.js";import{I as x}from"./input-K7STGv4F.js";import{L as m}from"./label-D_0g-RlU.js";import{S as o,a as j,b as h,c as u,d as f}from"./select-BhEU0EIQ.js";import{D as p,a as N,b as g,c as w,d as v}from"./dialog-CHNrEUkw.js";import{T as y,a as b,b as C,c as R,d as A,e as S}from"./table-BkpA8L4u.js";import{A as E}from"./AdminLayout-BWmn8TIL.js";import{d as U,e as L,f as F,h as $}from"./referrals-D7YWHBcV.js";import{U as T,$ as k,t as P,as as V,A as D,O as I,aJ as z,aH as B,a7 as O,ac as H}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./scroll-area-DkFg0wM_.js";const J=()=>{const{toast:J}=n(),[M,Q]=s.useState([]),[q,G]=s.useState(null),[K,W]=s.useState(!0),[X,Y]=s.useState(""),[Z,_]=s.useState("all"),[ee,se]=s.useState(!1),[re,ae]=s.useState(null),[le,te]=s.useState({status:"pending",rewardAmount:0,rewardClaimed:!1});s.useEffect(()=>{de()},[]);const de=async()=>{W(!0);try{const[e,s]=await Promise.all([U(),L()]);Q(e),G(s)}catch(e){J({title:"Error",description:"Failed to fetch referral data",variant:"destructive"})}finally{W(!1)}},ie=M.filter(e=>{var s,r,a;const l=(null==(s=e.referrerEmail)?void 0:s.toLowerCase().includes(X.toLowerCase()))||(null==(r=e.referrerName)?void 0:r.toLowerCase().includes(X.toLowerCase()))||e.referredEmail.toLowerCase().includes(X.toLowerCase())||(null==(a=e.referredUserName)?void 0:a.toLowerCase().includes(X.toLowerCase())),t="all"===Z||e.status===Z;return l&&t}),ne=s=>{switch(s){case"completed":return e.jsxs(i,{className:"bg-green-500/10 text-green-500 gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," Completed"]});case"pending":return e.jsxs(i,{className:"bg-yellow-500/10 text-yellow-500 gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," Pending"]});case"expired":return e.jsxs(i,{className:"bg-red-500/10 text-red-500 gap-1",children:[e.jsx(H,{className:"w-3 h-3"})," Expired"]});default:return e.jsx(i,{variant:"outline",children:s})}};return e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Referral Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and manage all referral registrations"})]})}),q&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Referrals"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.totalReferrals}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All registered referrals"})]})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Completed"}),e.jsx(k,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.completedReferrals}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:q.totalReferrals>0?`${(q.completedReferrals/q.totalReferrals*100).toFixed(1)}% completion rate`:"No referrals yet"})]})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Pending"}),e.jsx(P,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.pendingReferrals}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting signup"})]})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Rewards"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(t,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",q.totalRewards.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["$",q.claimedRewards.toFixed(2)," claimed"]})]})]})]}),q&&q.topReferrers.length>0&&e.jsxs(r,{children:[e.jsxs(a,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Top Referrers"]}),e.jsx(d,{children:"Users with the most referrals"})]}),e.jsx(t,{children:e.jsx("div",{className:"space-y-3",children:q.topReferrers.slice(0,5).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:["#",r+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.referrerName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.referrerEmail})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold",children:s.totalReferrals}),e.jsx("p",{className:"text-muted-foreground",children:"Referrals"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold",children:s.completedReferrals}),e.jsx("p",{className:"text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"font-bold",children:["$",s.totalRewards.toFixed(2)]}),e.jsx("p",{className:"text-muted-foreground",children:"Rewards"})]})]})]},s.referrerId))})})]}),e.jsx(r,{children:e.jsx(a,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by name or email...",value:X,onChange:e=>Y(e.target.value),className:"pl-10"})]}),e.jsxs(o,{value:Z,onValueChange:_,children:[e.jsx(j,{className:"w-full sm:w-[180px]",children:e.jsx(h,{placeholder:"Filter by status"})}),e.jsxs(u,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"completed",children:"Completed"}),e.jsx(f,{value:"expired",children:"Expired"})]})]})]})})}),e.jsxs(r,{children:[e.jsxs(a,{children:[e.jsx(l,{children:"All Referrals"}),e.jsxs(d,{children:[ie.length," referral",1!==ie.length?"s":""," found"]})]}),e.jsx(t,{children:K?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Loading referrals..."})}):0===ie.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No referrals found"})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(y,{children:[e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(R,{children:"Referrer"}),e.jsx(R,{children:"Referred Email"}),e.jsx(R,{children:"Referred User"}),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Reward"}),e.jsx(R,{children:"Date"}),e.jsx(R,{className:"text-right",children:"Actions"})]})}),e.jsx(A,{children:ie.map(s=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.referrerName||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.referrerEmail||"N/A"})]})}),e.jsx(S,{children:s.referredEmail}),e.jsx(S,{children:s.referredUserId?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.referredUserName}),e.jsx(i,{variant:"outline",className:"mt-1",children:s.referredUserType})]}):e.jsx("span",{className:"text-muted-foreground",children:"Not registered"})}),e.jsx(S,{children:ne(s.status)}),e.jsx(S,{children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["$",s.rewardAmount.toFixed(2)]}),s.rewardClaimed?e.jsx(i,{variant:"outline",className:"mt-1 text-xs",children:"Claimed"}):e.jsx(i,{variant:"outline",className:"mt-1 text-xs",children:"Unclaimed"})]})}),e.jsx(S,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(S,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(e=>{ae(e),te({status:e.status,rewardAmount:e.rewardAmount,rewardClaimed:e.rewardClaimed}),se(!0)})(s),children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this referral?"))try{await F(e),J({title:"Success",description:"Referral deleted successfully"}),await de()}catch(s){J({title:"Error",description:"Failed to delete referral",variant:"destructive"})}})(s.id),children:e.jsx(O,{className:"w-4 h-4 text-destructive"})})]})})]},s.id))})]})})})]}),e.jsx(p,{open:ee,onOpenChange:se,children:e.jsxs(N,{children:[e.jsxs(g,{children:[e.jsx(w,{children:"Edit Referral"}),e.jsx(v,{children:"Update referral status and reward information"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Status"}),e.jsxs(o,{value:le.status,onValueChange:e=>te({...le,status:e}),children:[e.jsx(j,{children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"completed",children:"Completed"}),e.jsx(f,{value:"expired",children:"Expired"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Reward Amount ($)"}),e.jsx(x,{type:"number",value:le.rewardAmount,onChange:e=>te({...le,rewardAmount:parseFloat(e.target.value)||0}),step:"0.01",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Reward Status"}),e.jsxs(o,{value:le.rewardClaimed?"claimed":"unclaimed",onValueChange:e=>te({...le,rewardClaimed:"claimed"===e}),children:[e.jsx(j,{children:e.jsx(h,{})}),e.jsxs(u,{children:[e.jsx(f,{value:"unclaimed",children:"Unclaimed"}),e.jsx(f,{value:"claimed",children:"Claimed"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),e.jsx(c,{onClick:async()=>{if(re)try{await $(re.id,le),J({title:"Success",description:"Referral updated successfully"}),await de(),se(!1)}catch(e){J({title:"Error",description:"Failed to update referral",variant:"destructive"})}},children:"Update Referral"})]})]})]})})]})})};export{J as default};
