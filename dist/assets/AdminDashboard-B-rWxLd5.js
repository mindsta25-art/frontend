import{j as e}from"./ui-BFkRrjhf.js";import{h as s,r as t}from"./vendor-ClsjX3Mm.js";import{C as a,b as r,c as l,a as n,d as i}from"./card-COhXL4y3.js";import{T as o,a as c,b as d,c as x}from"./tabs-C0D04NFg.js";import{A as m}from"./AdminLayout-BWmn8TIL.js";import{u as h,L as u}from"./index-CgruMJ9X.js";import{g as j,a as p,b as f}from"./analytics-jhJgQtef.js";import{U as y,ay as v,as as g,aJ as N,aK as b,N as w,g as S,J as R,v as k}from"./icons-Udnp6KR8.js";import{R as D,A as L,C,X as U,Y as K,T as $,a as A,L as P,b as T,d as O,B as E,e as F,P as G,f as I,g as M}from"./charts-DeubIqjP.js";import"./scroll-area-DkFg0wM_.js";const W=()=>{const{toast:W}=h(),B=s(),[J,Q]=t.useState(!0),[z,V]=t.useState({totalStudents:0,totalLessons:0,activeUsers:0,completionRate:0}),[X,Y]=t.useState([]),[q,H]=t.useState([]),[Z,_]=t.useState(null),[ee,se]=t.useState([]),[te,ae]=t.useState([]),[re,le]=t.useState([]),[ne,ie]=t.useState([]),oe=["#667eea","#764ba2","#f093fb","#4facfe","#00f2fe","#43e97b"];t.useEffect(()=>{de(),xe(),ce()},[]);const ce=async()=>{try{const e=await j(10);ie(e||[])}catch(e){}},de=async()=>{try{Q(!0);const[e,s]=await Promise.all([p(),f()]);V({totalStudents:(null==s?void 0:s.totalStudents)||e.totalStudents||0,totalLessons:e.totalLessons||0,activeUsers:(null==s?void 0:s.activeUsers)||e.activeUsers||0,completionRate:e.completionRate||0,totalEducators:e.totalEducators,totalParents:e.totalParents,totalUsers:(null==s?void 0:s.totalUsers)||0,paidStudents:(null==s?void 0:s.paidStudents)||0,totalReferrals:(null==s?void 0:s.totalReferrals)||0,totalRevenue:(null==s?void 0:s.totalRevenue)||0,totalCommissions:(null==s?void 0:s.totalCommissions)||0,conversionRate:(null==s?void 0:s.conversionRate)||e.completionRate||0,totalEnrollments:(null==s?void 0:s.totalEnrollments)||0})}catch(e){W({title:"Error",description:"Failed to load dashboard statistics.",variant:"destructive"})}finally{Q(!1)}},xe=async()=>{try{const e={Authorization:`Bearer ${localStorage.getItem("token")}`},[s,t,a,r,l,n]=await Promise.all([fetch("/api/analytics/user-growth?days=30",{headers:e}).then(e=>e.ok?e.json():[]).catch(()=>[]),fetch("/api/analytics/revenue-over-time?days=30",{headers:e}).then(e=>e.ok?e.json():[]).catch(()=>[]),fetch("/api/analytics/referral-performance?days=30",{headers:e}).then(e=>e.ok?e.json():null).catch(()=>null),fetch("/api/analytics/user-types",{headers:e}).then(e=>e.ok?e.json():[]).catch(()=>[]),fetch("/api/analytics/payment-status",{headers:e}).then(e=>e.ok?e.json():[]).catch(()=>[]),fetch("/api/analytics/student-grades",{headers:e}).then(e=>e.ok?e.json():[]).catch(()=>[])]);Y(s),H(t),_(a),se(r),ae(l),le(n)}catch(e){}};if(J)return e.jsx(u,{message:"Loading admin dashboard..."});const me=[{title:"Total Users",value:z.totalUsers||0,icon:y,description:"All registered users",color:"text-blue-500"},{title:"Paid Students",value:z.paidStudents||0,icon:v,description:"Active subscriptions",color:"text-green-500"},{title:"Total Revenue",value:z.totalRevenue?`₦${z.totalRevenue.toLocaleString()}`:"₦0",icon:g,description:"Lifetime revenue",color:"text-emerald-500"},{title:"Total Referrals",value:z.totalReferrals||0,icon:N,description:"Referral partners",color:"text-purple-500"},{title:"Active Users",value:z.activeUsers||0,icon:b,description:"Users this week",color:"text-cyan-500"},{title:"Total Enrollments",value:z.totalEnrollments||0,icon:w,description:"Courses purchased",color:"text-orange-500"},{title:"Conversion Rate",value:`${z.conversionRate||0}%`,icon:S,description:"Student to paid",color:"text-orange-500"}];return e.jsx(m,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Welcome to the Mindsta admin panel. Monitor and manage your educational platform."})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:me.map(s=>{const t=s.icon;return e.jsxs(a,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s.title}),e.jsx(t,{className:`h-4 w-4 ${s.color}`})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]})]},s.title)})}),e.jsxs(o,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(c,{children:[e.jsx(d,{value:"overview",children:"Overview"}),e.jsx(d,{value:"recent",children:"Recent Activity"}),e.jsx(d,{value:"analytics",children:"Analytics"})]}),e.jsx(x,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Quick Actions"}),e.jsx(i,{children:"Common administrative tasks"})]}),e.jsxs(n,{className:"space-y-2",children:[e.jsx("button",{onClick:()=>B("/admin/notifications"),className:"w-full text-left px-4 py-2 rounded-lg hover:bg-muted transition-colors",children:"Send Notifications"}),e.jsx("button",{onClick:()=>B("/admin/referrals"),className:"w-full text-left px-4 py-2 rounded-lg hover:bg-muted transition-colors",children:"Referral Management"}),e.jsx("button",{onClick:()=>B("/admin/referral-payouts"),className:"w-full text-left px-4 py-2 rounded-lg hover:bg-muted transition-colors",children:"Referral Payouts"}),e.jsx("button",{onClick:()=>B("/admin/reports"),className:"w-full text-left px-4 py-2 rounded-lg hover:bg-muted transition-colors",children:"Generate Report"}),e.jsx("button",{onClick:()=>B("/admin/users"),className:"w-full text-left px-4 py-2 rounded-lg hover:bg-muted transition-colors",children:"Manage Users"})]})]}),e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"System Status"}),e.jsx(i,{children:"Current system health and performance"})]}),e.jsxs(n,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Database"}),e.jsx("span",{className:"text-sm font-medium text-green-500",children:"●  Operational"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"API Server"}),e.jsx("span",{className:"text-sm font-medium text-green-500",children:"●  Operational"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Storage"}),e.jsx("span",{className:"text-sm font-medium text-green-500",children:"●  Operational"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Authentication"}),e.jsx("span",{className:"text-sm font-medium text-green-500",children:"●  Operational"})]})]})]})]})}),e.jsx(x,{value:"recent",className:"space-y-4",children:e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Recent Course Purchases"]}),e.jsx(i,{children:"Latest enrollment purchases in the system"})]}),e.jsx(n,{children:0===ne.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No recent purchases yet"})]}):e.jsx("div",{className:"space-y-3",children:ne.map((s,t)=>{var a;return e.jsxs("div",{className:"flex items-start gap-4 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("div",{className:"p-2 rounded bg-green-500/10",children:e.jsx(R,{className:"w-4 h-4 text-green-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.userName}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.subject," - Grade ",s.grade," ",s.term&&`• ${s.term}`]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs font-semibold text-green-600",children:["₦",null==(a=s.price)?void 0:a.toLocaleString()]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.purchasedAt).toLocaleDateString()})]})]})]},s.id||t)})})})]})}),e.jsxs(x,{value:"analytics",className:"space-y-4",children:[e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"User Growth (Last 30 Days)"]}),e.jsx(i,{children:"Daily new user registrations"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(L,{data:X,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorCount",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#667eea",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#667eea",stopOpacity:0})]})}),e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(K,{}),e.jsx($,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[`${e} users`,"New Users"]}),e.jsx(A,{type:"monotone",dataKey:"count",stroke:"#667eea",fillOpacity:1,fill:"url(#colorCount)"})]})})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Revenue Over Time"}),e.jsx(i,{children:"Daily revenue and cumulative total"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(P,{data:q,children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(K,{}),e.jsx($,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[`₦${e.toLocaleString()}`,""]}),e.jsx(T,{}),e.jsx(O,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:2,name:"Daily Revenue"}),e.jsx(O,{type:"monotone",dataKey:"cumulativeRevenue",stroke:"#667eea",strokeWidth:2,name:"Total Revenue"})]})})})]}),e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Referral Signups"}),e.jsx(i,{children:"New referrals over time"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(E,{data:(null==Z?void 0:Z.signups)||[],children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx(K,{}),e.jsx($,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[`${e} signups`,"Referrals"]}),e.jsx(F,{dataKey:"count",fill:"#764ba2"})]})})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"User Types"}),e.jsx(i,{children:"Distribution by user type"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:250,children:e.jsxs(G,{children:[e.jsx(I,{data:ee,cx:"50%",cy:"50%",labelLine:!1,label:({type:e,count:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"count",nameKey:"type",children:ee.map((s,t)=>e.jsx(M,{fill:oe[t%oe.length]},`cell-${t}`))}),e.jsx($,{})]})})})]}),e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Payment Status"}),e.jsx(i,{children:"Payments by status"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:250,children:e.jsxs(G,{children:[e.jsx(I,{data:te,cx:"50%",cy:"50%",labelLine:!1,label:({status:e,count:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"count",nameKey:"status",children:te.map((s,t)=>e.jsx(M,{fill:oe[t%oe.length]},`cell-${t}`))}),e.jsx($,{formatter:(e,s,t)=>[`${e} (₦${t.payload.amount.toLocaleString()})`,s]})]})})})]}),e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Grade Distribution"}),e.jsx(i,{children:"Students by grade level"})]}),e.jsx(n,{children:e.jsx(D,{width:"100%",height:250,children:e.jsxs(E,{data:re,children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"grade"}),e.jsx(K,{}),e.jsx($,{}),e.jsx(T,{}),e.jsx(F,{dataKey:"paid",stackId:"a",fill:"#10b981",name:"Paid"}),e.jsx(F,{dataKey:"unpaid",stackId:"a",fill:"#ef4444",name:"Unpaid"})]})})})]})]}),Z&&e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"Referral Program Performance"}),e.jsx(i,{children:"Key metrics for the referral program"})]}),e.jsx(n,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Referrals"}),e.jsx("p",{className:"text-2xl font-bold",children:Z.totalReferrals})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed Referrals"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:Z.completedReferrals})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conversion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-500",children:[Z.conversionRate,"%"]})]})]})})]})]})]})]})})};export{W as default};
