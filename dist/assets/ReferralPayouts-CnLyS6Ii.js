import{j as e}from"./ui-BFkRrjhf.js";import{r as s}from"./vendor-ClsjX3Mm.js";import{i as a,j as t}from"./referrals-D7YWHBcV.js";import{u as r,B as l}from"./index-CgruMJ9X.js";import{C as n,b as i,c,a as d,d as x}from"./card-COhXL4y3.js";import{D as o,a as m,b as h,c as j,d as f,e as g}from"./dialog-CHNrEUkw.js";import{L as N}from"./label-D_0g-RlU.js";import{T as p}from"./textarea-Cg6ZmrUp.js";import{T as u,a as y,b,c as v,d as w,e as P}from"./table-BkpA8L4u.js";import{A as R}from"./AdminLayout-BWmn8TIL.js";import{U as S,as as k,C,$ as E,aQ as L}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./scroll-area-DkFg0wM_.js";const A=()=>{const[A,T]=s.useState(null),[B,O]=s.useState(!0),[D,F]=s.useState(!1),[$,I]=s.useState(null),[Q,U]=s.useState(""),[V,z]=s.useState(!1),{toast:M}=r();s.useEffect(()=>{W()},[]);const W=async()=>{try{O(!0);const e=await a();T(e)}catch(e){M({title:"Error",description:e.message||"Failed to load referral data",variant:"destructive"})}finally{O(!1)}};return B?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})})}):A?e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",children:"Referral Payouts"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage referrer payments and bank details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(n,{className:"border-purple-200",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Referrers"}),e.jsx(S,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:A.totals.totalReferrers}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[A.totals.totalReferrals," total referrals"]})]})]}),e.jsxs(n,{className:"border-green-200",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Earnings"}),e.jsx(k,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["₦",A.totals.totalEarnings.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All commissions earned"})]})]}),e.jsxs(n,{className:"border-orange-200",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Pending Payouts"}),e.jsx(C,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["₦",A.totals.totalPendingEarnings.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Awaiting processing"})]})]}),e.jsxs(n,{className:"border-blue-200",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Paid Out"}),e.jsx(E,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₦",A.totals.totalPaidOut.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[A.totals.referrersWithBankDetails," with bank details"]})]})]})]}),e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Referrer Accounts"}),e.jsx(x,{children:"View bank details and process payouts"})]}),e.jsx(d,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(u,{children:[e.jsx(y,{children:e.jsxs(b,{children:[e.jsx(v,{children:"Referrer"}),e.jsx(v,{children:"Code"}),e.jsx(v,{className:"text-right",children:"Referrals"}),e.jsx(v,{className:"text-right",children:"Conv. Rate"}),e.jsx(v,{className:"text-right",children:"Total Earned"}),e.jsx(v,{className:"text-right",children:"Pending"}),e.jsx(v,{className:"text-right",children:"Paid Out"}),e.jsx(v,{children:"Bank Details"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(w,{children:0===A.referrers.length?e.jsx(b,{children:e.jsx(P,{colSpan:9,className:"text-center text-gray-500 py-8",children:"No referrers found"})}):A.referrers.map(s=>e.jsxs(b,{children:[e.jsx(P,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.fullName}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})}),e.jsx(P,{children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.referralCode})}),e.jsx(P,{className:"text-right",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.totalReferrals}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.completedReferrals," completed"]})]})}),e.jsx(P,{className:"text-right",children:e.jsxs("span",{className:"font-medium "+(s.conversionRate>=50?"text-green-600":s.conversionRate>=25?"text-yellow-600":"text-gray-600"),children:[s.conversionRate,"%"]})}),e.jsxs(P,{className:"text-right font-medium",children:["₦",s.totalEarnings.toLocaleString()]}),e.jsx(P,{className:"text-right",children:e.jsxs("span",{className:"font-medium "+(s.pendingEarnings>0?"text-orange-600":"text-gray-400"),children:["₦",s.pendingEarnings.toLocaleString()]})}),e.jsxs(P,{className:"text-right text-blue-600 font-medium",children:["₦",s.paidOutEarnings.toLocaleString()]}),e.jsx(P,{children:s.hasBankDetails?e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium",children:s.bankName}),e.jsx("p",{className:"text-gray-500",children:s.accountNumber}),e.jsx("p",{className:"text-gray-500",children:s.accountName})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Not set"})}),e.jsx(P,{className:"text-right",children:e.jsxs(l,{size:"sm",onClick:()=>(e=>{I(e),U(""),z(!0)})(s),disabled:!s.hasBankDetails||0===s.pendingEarnings,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Pay"]})})]},s.userId))})]})})})]}),e.jsx(o,{open:V,onOpenChange:z,children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(j,{children:"Process Payout"}),e.jsxs(f,{children:["Confirm payout for ",null==$?void 0:$.fullName]})]}),$&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Referrer:"}),e.jsx("span",{className:"font-medium",children:$.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:$.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bank:"}),e.jsx("span",{className:"font-medium",children:$.bankName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Account:"}),e.jsx("span",{className:"font-medium",children:$.accountNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium",children:$.accountName})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Pending Transactions:"}),e.jsx("span",{className:"font-medium",children:$.pendingTransactions})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Payout Amount:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["₦",$.pendingEarnings.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"notes",children:"Payment Notes (Optional)"}),e.jsx(p,{id:"notes",placeholder:"Add transaction reference or notes...",value:Q,onChange:e=>U(e.target.value),className:"mt-1"})]})]}),e.jsxs(g,{children:[e.jsx(l,{variant:"outline",onClick:()=>z(!1),disabled:D,children:"Cancel"}),e.jsx(l,{onClick:async()=>{if($)try{F(!0);const e=await t($.userId,Q);M({title:"Payout Processed",description:`₦${e.amount.toLocaleString()} paid out to ${e.referrerEmail}`}),z(!1),I(null),U(""),W()}catch(e){M({title:"Payout Failed",description:e.message||"Failed to process payout",variant:"destructive"})}finally{F(!1)}},disabled:D,className:"bg-green-600 hover:bg-green-700",children:D?"Processing...":"Confirm Payout"})]})]})})]})}):e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Unable to load referral data"}),e.jsx(l,{onClick:W,className:"mt-4",children:"Retry"})]})})})};export{A as default};
