import{j as e}from"./ui-BFkRrjhf.js";import{r as s}from"./vendor-ClsjX3Mm.js";import{C as a,b as t,c as l,d as r,a as i}from"./card-COhXL4y3.js";import{T as n,a as d,b as c,c as u}from"./tabs-C0D04NFg.js";import{f as o,u as m,L as h,B as x}from"./index-CgruMJ9X.js";import{I as j}from"./input-K7STGv4F.js";import{B as p}from"./badge-CO1u2g-4.js";import{T as f,a as v,b as g,c as y,d as N,e as b}from"./table-BkpA8L4u.js";import{A as w}from"./AdminLayout-BWmn8TIL.js";import{s as S}from"./siteConfig-BOV2ERHg.js";import{D as C,a as U,b as A,c as T,d as F,e as D}from"./dialog-CHNrEUkw.js";import{L as E}from"./label-D_0g-RlU.js";import{S as L,a as $,b as P,c as k,d as J}from"./select-BhEU0EIQ.js";import{S as M,aJ as O,O as V,M as I,aH as R,a7 as z,aN as B}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./scroll-area-DkFg0wM_.js";const q=()=>{const{toast:q}=m(),[H,Q]=s.useState(!0),[G,K]=s.useState([]),[W,X]=s.useState(""),[Y,Z]=s.useState("all"),[_,ee]=s.useState(!1),[se,ae]=s.useState(!1),[te,le]=s.useState(""),[re,ie]=s.useState(""),[ne,de]=s.useState(""),[ce,ue]=s.useState(!1),[oe,me]=s.useState(null),[he,xe]=s.useState(""),[je,pe]=s.useState(""),[fe,ve]=s.useState(""),[ge,ye]=s.useState(!1);s.useEffect(()=>{Ne()},[]);const Ne=async()=>{try{Q(!0);const e=(await(async()=>{try{return await o.get("/profiles")}catch(e){return[]}})()).map(e=>({id:e.id,email:e.email,fullName:e.fullName,userType:e.userType,createdAt:e.createdAt||(new Date).toISOString(),status:"active"}));K(e)}catch(e){q({title:"Error",description:"Failed to load users. Please try again.",variant:"destructive"})}finally{Q(!1)}},be=G.filter(e=>{var s;const a=(null==(s=e.fullName)?void 0:s.toLowerCase().includes(W.toLowerCase()))||e.email.toLowerCase().includes(W.toLowerCase()),t="all"===Y||e.userType===Y;return a&&t}),we=e=>{switch(e){case"student":return"bg-blue-500/10 text-blue-500";case"referral":return"bg-green-500/10 text-green-500";case"admin":return"bg-red-500/10 text-red-500";default:return"bg-gray-500/10 text-gray-500"}},Se=e=>{switch(e){case"active":return"bg-green-500/10 text-green-500";case"inactive":default:return"bg-gray-500/10 text-gray-500";case"suspended":return"bg-red-500/10 text-red-500"}};if(H)return e.jsx(h,{message:"Loading user management..."});const Ce={all:G.length,student:G.filter(e=>"student"===e.userType).length,referral:G.filter(e=>"referral"===e.userType).length,admin:G.filter(e=>"admin"===e.userType).length},Ue=async e=>{if(window.confirm(`Are you sure you want to permanently delete ${e.email}? This action cannot be undone.`))try{await(async e=>o.delete(`/admin/users/${e}`))(e.id),q({title:"User Deleted",description:`Successfully deleted ${e.email}`}),await Ne()}catch(s){q({title:"Delete Failed",description:(null==s?void 0:s.message)||"Unable to delete user",variant:"destructive"})}};return e.jsxs(w,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage students, referrals, and admins"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",className:"gap-2",onClick:()=>ae(!0),children:[e.jsx(M,{className:"w-4 h-4"}),"New Admin"]}),e.jsxs(x,{className:"gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Add User"]})]})]}),e.jsx(a,{children:e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Search users by name or email...",value:W,onChange:e=>X(e.target.value),className:"pl-10"})]}),e.jsx(x,{variant:"outline",type:"button",children:"Export"})]})})}),e.jsxs(n,{value:Y,onValueChange:Z,children:[e.jsxs(d,{className:"grid w-full grid-cols-4",children:[e.jsxs(c,{value:"all",children:["All Users (",Ce.all,")"]}),e.jsxs(c,{value:"student",children:["Students (",Ce.student,")"]}),e.jsxs(c,{value:"referral",children:["Referrals (",Ce.referral,")"]}),e.jsxs(c,{value:"admin",children:["Admins (",Ce.admin,")"]})]}),e.jsx(u,{value:Y,className:"mt-4",children:e.jsxs(a,{children:[e.jsxs(t,{children:[e.jsx(l,{children:"User List"}),e.jsxs(r,{children:[be.length," user(s) found"]})]}),e.jsx(i,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(g,{children:[e.jsx(y,{children:"Name"}),e.jsx(y,{children:"Email"}),e.jsx(y,{children:"Type"}),e.jsx(y,{children:"Status"}),e.jsx(y,{children:"Joined"}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx(N,{children:0===be.length?e.jsx(g,{children:e.jsx(b,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No users found matching your criteria"})}):be.map(s=>e.jsxs(g,{children:[e.jsx(b,{className:"font-medium",children:s.fullName||"N/A"}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-3 h-3 text-muted-foreground"}),s.email]})}),e.jsx(b,{children:e.jsx(p,{className:we(s.userType),children:s.userType})}),e.jsx(b,{children:e.jsx(p,{className:Se(s.status),children:s.status||"active"})}),e.jsx(b,{className:"text-muted-foreground text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>(e=>{me(e),xe(e.fullName||""),pe(e.userType),ve(e.status||"active"),ue(!0)})(s),className:"gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Edit"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Ue(s),className:"gap-2 text-destructive hover:text-destructive",children:[e.jsx(z,{className:"w-4 h-4"}),"Delete"]})]})})]},s.id))})]})})})]})})]})]}),e.jsx(C,{open:se,onOpenChange:ae,children:e.jsxs(U,{children:[e.jsxs(A,{children:[e.jsx(T,{children:"Create Admin Account"}),e.jsx(F,{children:"Provide details for the new administrator."})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),te&&re&&ne)try{ee(!0);const e=await(async e=>await o.post("/admin/admins",e))({email:te,password:re,fullName:ne});q({title:"Admin Created",description:`Successfully created admin ${e.email}`}),await Ne(),le(""),ie(""),de(""),ae(!1)}catch(s){q({title:"Creation Failed",description:(null==s?void 0:s.message)||"Unable to create admin",variant:"destructive"})}finally{ee(!1)}else q({title:"Missing fields",description:"Email, password and full name are required.",variant:"destructive"})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"adminFullName",children:"Full Name"}),e.jsx(j,{id:"adminFullName",value:ne,onChange:e=>de(e.target.value),placeholder:"Jane Doe",disabled:_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"adminEmail",children:"Email"}),e.jsx(j,{id:"adminEmail",type:"email",value:te,onChange:e=>le(e.target.value),placeholder:`admin@${S.company.name.toLowerCase()}.com`,disabled:_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"adminPassword",children:"Password"}),e.jsx(j,{id:"adminPassword",type:"password",value:re,onChange:e=>ie(e.target.value),placeholder:"Enter secure password",disabled:_})]}),e.jsxs(D,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>ae(!1),disabled:_,children:"Cancel"}),e.jsxs(x,{type:"submit",disabled:_,className:"gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),_?"Creating...":"Create Admin"]})]})]})]})}),e.jsx(C,{open:ce,onOpenChange:ue,children:e.jsxs(U,{children:[e.jsxs(A,{children:[e.jsx(T,{children:"Edit User"}),e.jsxs(F,{children:["Update user details for ",null==oe?void 0:oe.email]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),oe)try{ye(!0),await(async(e,s)=>o.patch(`/admin/users/${e}`,s))(oe.id,{fullName:he,userType:je,status:fe}),q({title:"User Updated",description:`Successfully updated ${oe.email}`}),await Ne(),ue(!1),me(null)}catch(s){q({title:"Update Failed",description:(null==s?void 0:s.message)||"Unable to update user",variant:"destructive"})}finally{ye(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"editFullName",children:"Full Name"}),e.jsx(j,{id:"editFullName",value:he,onChange:e=>xe(e.target.value),placeholder:"John Doe",disabled:ge})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"editUserType",children:"User Type"}),e.jsxs(L,{value:je,onValueChange:pe,disabled:ge,children:[e.jsx($,{id:"editUserType",children:e.jsx(P,{placeholder:"Select user type"})}),e.jsxs(k,{children:[e.jsx(J,{value:"student",children:"Student"}),e.jsx(J,{value:"referral",children:"Referral"}),e.jsx(J,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"editStatus",children:"Status"}),e.jsxs(L,{value:fe,onValueChange:ve,disabled:ge,children:[e.jsx($,{id:"editStatus",children:e.jsx(P,{placeholder:"Select status"})}),e.jsxs(k,{children:[e.jsx(J,{value:"active",children:"Active"}),e.jsx(J,{value:"inactive",children:"Inactive"}),e.jsx(J,{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs(D,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>ue(!1),disabled:ge,children:"Cancel"}),e.jsx(x,{type:"submit",disabled:ge,children:ge?"Updating...":"Update User"})]})]})]})})]})};export{q as default};
