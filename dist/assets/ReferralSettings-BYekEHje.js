import{j as e}from"./ui-BFkRrjhf.js";import{r as s,h as a}from"./vendor-ClsjX3Mm.js";import{u as t}from"./forms-D4rj3dEP.js";import{t as r,b as l}from"./validations-f3Vz4Ei2.js";import{c as n,a as i,u as c,r as o}from"./referrals-D7YWHBcV.js";import{u as m,B as d}from"./index-CgruMJ9X.js";import{C as x,a as u}from"./card-COhXL4y3.js";import{T as h,a as j,b as p,c as N}from"./tabs-C0D04NFg.js";import{D as g,f as b,a as f,b as v,c as y,d as S,e as k}from"./dialog-CHNrEUkw.js";import{a3 as w,at as C,au as R,ao as P,ai as A,av as E}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";const L=()=>{const{toast:L}=m(),[q,D]=s.useState(null),[$,T]=s.useState([]),[F,O]=s.useState(!0),[V,z]=s.useState(!1),[I,Q]=s.useState(!1),[U,Y]=s.useState(!1),[G,H]=s.useState("bank"),J=a(),K=t({resolver:r(l),defaultValues:{accountNumber:"",bankName:"",accountName:"",commissionRate:0}}),M=async()=>{O(!0);try{const[e,s]=await Promise.all([n(),i()]);D(e),T(s),e&&K.reset({accountNumber:e.accountNumber||"",bankName:e.bankName||"",accountName:e.accountName||"",commissionRate:100*(e.commissionRate||0)})}catch(e){L({title:"Error",description:e.message||"Failed to load referral settings",variant:"destructive"})}finally{O(!1)}};s.useEffect(()=>{M()},[]);return F?e.jsx("div",{className:"p-8 text-center",children:"Loading referral settings..."}):e.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Referral Settings"}),e.jsxs(d,{variant:"outline",onClick:()=>J("/referral/dashboard"),children:[e.jsx(w,{className:"h-4 w-4 mr-2"})," Back to Dashboard"]})]}),e.jsxs(h,{value:G,onValueChange:e=>H(e),className:"space-y-4",children:[e.jsxs(j,{className:"grid w-full grid-cols-1 md:grid-cols-3",children:[e.jsxs(p,{value:"bank",className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"})," Bank & Commission"]}),e.jsxs(p,{value:"earnings",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"})," Earnings & Payout"]}),e.jsxs(p,{value:"transactions",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"})," Transactions"]})]}),e.jsx(N,{value:"bank",children:e.jsx("form",{onSubmit:K.handleSubmit(async e=>{if(q){z(!0);try{const s=await c({...q,accountNumber:e.accountNumber,bankName:e.bankName,accountName:e.accountName,commissionRate:e.commissionRate/100});D(s),L({title:"Saved",description:"Bank details updated successfully"})}catch(s){L({title:"Error",description:s.message||"Save failed",variant:"destructive"})}finally{z(!1)}}}),className:"grid gap-6 md:grid-cols-2",children:e.jsx(x,{className:"md:col-span-2",children:e.jsxs(u,{className:"p-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bank Name"}),e.jsx("input",{...K.register("bankName"),className:"w-full border rounded px-3 py-2",placeholder:"e.g. Access Bank"}),K.formState.errors.bankName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:K.formState.errors.bankName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bank Code"}),e.jsx("input",{value:(null==q?void 0:q.bankCode)||"",onChange:e=>D(s=>s?{...s,bankCode:e.target.value}:s),className:"w-full border rounded px-3 py-2",placeholder:"e.g. 044"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Account Number"}),e.jsx("input",{...K.register("accountNumber"),className:"w-full border rounded px-3 py-2",placeholder:"10-digit account number",maxLength:10}),K.formState.errors.accountNumber&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:K.formState.errors.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Account Name"}),e.jsx("input",{...K.register("accountName"),className:"w-full border rounded px-3 py-2",placeholder:"Full account name"}),K.formState.errors.accountName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:K.formState.errors.accountName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Commission Rate (%)"}),e.jsx("input",{type:"number",...K.register("commissionRate",{valueAsNumber:!0}),min:0,max:100,step:"0.1",className:"w-full border rounded px-3 py-2",placeholder:"e.g. 10"}),K.formState.errors.commissionRate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:K.formState.errors.commissionRate.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Commission you earn per referral payment (0-100%)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(d,{type:"submit",disabled:V,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),V?"Saving...":"Save Settings"]})})]})})})}),e.jsx(N,{value:"earnings",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx(B,{label:"Total Earnings",value:`₦${((null==q?void 0:q.totalEarnings)||0).toLocaleString()}`}),e.jsx(B,{label:"Pending",value:`₦${((null==q?void 0:q.pendingEarnings)||0).toLocaleString()}`}),e.jsx(B,{label:"Paid Out",value:`₦${((null==q?void 0:q.paidOutEarnings)||0).toLocaleString()}`}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(g,{open:U,onOpenChange:Y,children:[e.jsx(b,{asChild:!0,children:e.jsx(d,{disabled:I||((null==q?void 0:q.pendingEarnings)||0)<=0,children:I?"Processing...":"Request Payout"})}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-orange-600"})," Confirm Payout Request"]}),e.jsxs(S,{children:["You are about to request payout for ",e.jsxs("strong",{children:["₦",((null==q?void 0:q.pendingEarnings)||0).toLocaleString()]})," in pending commissions. This will mark those commissions as paid and generate a payout batch. Continue?"]})]}),e.jsxs(k,{className:"mt-4 flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>Y(!1),disabled:I,children:"Cancel"}),e.jsx(d,{onClick:async()=>{Q(!0);try{const e=await o();L({title:"Payout Requested",description:`Batch ${e.batchId} - ₦${e.amount}`}),await M(),Y(!1)}catch(e){L({title:"Payout Failed",description:e.message||"Unable to process payout",variant:"destructive"})}finally{Q(!1)}},disabled:I,className:"bg-orange-600 hover:bg-orange-700",children:I?"Submitting...":"Confirm Request"})]})]})]})})]})}),e.jsx(N,{value:"transactions",children:e.jsx(x,{children:e.jsx(u,{className:"p-0",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Created"}),e.jsx("th",{className:"p-2 text-left",children:"Amount Paid"}),e.jsx("th",{className:"p-2 text-left",children:"Commission"}),e.jsx("th",{className:"p-2 text-left",children:"Status"}),e.jsx("th",{className:"p-2 text-left",children:"Paid At"})]})}),e.jsxs("tbody",{children:[$.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"p-2",children:["₦",s.amountPaid.toLocaleString()]}),e.jsxs("td",{className:"p-2",children:["₦",s.commissionAmount.toLocaleString()]}),e.jsx("td",{className:"p-2 capitalize",children:s.status}),e.jsx("td",{className:"p-2",children:s.paidAt?new Date(s.paidAt).toLocaleDateString():"-"})]},s.id)),0===$.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-4 text-center text-gray-500",children:"No transactions yet"})})]})]})})})})]})]})},B=({label:s,value:a})=>e.jsx(x,{children:e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:s}),e.jsx("div",{className:"text-lg font-semibold",children:a})]})});export{L as default};
