import{j as e}from"./ui-BFkRrjhf.js";import{h as s,r as t}from"./vendor-ClsjX3Mm.js";import{a,B as r}from"./index-CgruMJ9X.js";import{S as l,g as n}from"./StudentHeader-BEY8Ekm7.js";import{C as o,a as c}from"./card-COhXL4y3.js";import{B as d}from"./badge-CO1u2g-4.js";import{P as i}from"./progress-BCMZ4yGb.js";import{I as m}from"./input-K7STGv4F.js";import{S as x,a as g,b as u,c as h,d as j}from"./select-BhEU0EIQ.js";import{getLessons as p}from"./lessons-BDW73QPv.js";import{g as f,a as N}from"./enrollments-ZADooVCN.js";import{B as b,g as v,v as w,$ as y,t as S,u as C}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./separator-D-EoJ3Ty.js";import"./scroll-area-DkFg0wM_.js";import"./formatDistanceToNow-Bf1kdoXg.js";import"./siteConfig-BOV2ERHg.js";const A=()=>{const{user:A,loading:k}=a(),L=s(),[T,$]=t.useState(""),[D,M]=t.useState([]),[P,z]=t.useState([]),[q,B]=t.useState([]),[E,I]=t.useState([]),[R,V]=t.useState(!0),[Z,G]=t.useState("all"),[H,O]=t.useState(""),[Q,U]=t.useState("recent");t.useEffect(()=>{k||A||L("/auth")},[A,k,L]),t.useEffect(()=>{(async()=>{if(A)try{V(!0);const[e,s,t,a]=await Promise.all([n(A.id),p(),f(A.id),N()]);e&&$(e.fullName),B(s),I(t),z(a);const r=s.filter(e=>a.some(s=>s.subject===e.subject&&s.grade===e.grade&&s.term===e.term)),l=new Map;for(const n of r){const e=`${n.subject}-${n.grade}-${n.term||"general"}`;if(!l.has(e)){const s=a.find(e=>e.subject===n.subject&&e.grade===n.grade&&e.term===n.term);l.set(e,{subject:n.subject,grade:n.grade,term:n.term,lessonsTotal:0,lessonsCompleted:0,progress:0,nextLesson:void 0,averageScore:void 0,enrollmentDate:s?new Date(s.purchasedAt||s.createdAt):void 0})}const s=l.get(e);s.lessonsTotal+=1;const o=t.find(e=>e.lessonId===n.id);if(o){o.completed&&(s.lessonsCompleted+=1);const e=new Date(o.lastAccessedAt);(!s.lastAccessed||e>s.lastAccessed)&&(s.lastAccessed=e),o.completed||s.nextLesson||(s.nextLesson=n)}else s.nextLesson||(s.nextLesson=n);const c=t.filter(e=>{const t=r.find(s=>s.id===e.lessonId);return t&&t.subject===s.subject&&t.grade===s.grade&&t.term===s.term&&"number"==typeof e.quizScore}).map(e=>e.quizScore);c.length>0&&(s.averageScore=Math.round(c.reduce((e,s)=>e+s,0)/c.length))}l.forEach(e=>{e.progress=e.lessonsTotal>0?Math.round(e.lessonsCompleted/e.lessonsTotal*100):0});const o=Array.from(l.values());M(o)}catch(e){}finally{V(!1)}})()},[A]);const X=()=>{let e=D;if("all"!==Z&&(e=e.filter(e=>e.subject===Z)),H){const s=H.toLowerCase();e=e.filter(e=>{var t;return e.subject.toLowerCase().includes(s)||e.grade.toLowerCase().includes(s)||(null==(t=e.term)?void 0:t.toLowerCase().includes(s))})}return"recent"===Q?e.sort((e,s)=>{if(e.enrollmentDate&&s.enrollmentDate){const t=s.enrollmentDate.getTime()-e.enrollmentDate.getTime();if(0!==t)return t}return e.enrollmentDate&&!s.enrollmentDate?-1:!e.enrollmentDate&&s.enrollmentDate?1:e.lastAccessed?s.lastAccessed?s.lastAccessed.getTime()-e.lastAccessed.getTime():-1:1}):"progress"===Q?e.sort((e,s)=>s.progress-e.progress):"title"===Q&&e.sort((e,s)=>e.subject.localeCompare(s.subject)),e},Y=Array.from(new Set(D.map(e=>e.subject)));return k||R?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(l,{studentName:T}),e.jsx("div",{className:"pt-24 container mx-auto px-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-800 rounded w-1/4"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx("div",{className:"h-48 bg-gray-200 dark:bg-gray-800 rounded"},s))})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(l,{studentName:T}),e.jsxs("main",{className:"pt-24 pb-16 container mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"My Learning"}),e.jsx("p",{className:"text-muted-foreground",children:"Continue where you left off and track your progress"})]}),D.length>0&&e.jsxs("div",{className:"mb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-5 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"p-2.5 md:p-3 bg-blue-100 dark:bg-blue-900 rounded-lg flex-shrink-0",children:e.jsx(b,{className:"w-5 h-5 md:w-6 md:h-6 text-blue-600 dark:text-blue-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:E.filter(e=>e.completed).length}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",children:"Lessons Completed"})]})]})})}),e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-5 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"p-2.5 md:p-3 bg-green-100 dark:bg-green-900 rounded-lg flex-shrink-0",children:e.jsx(v,{className:"w-5 h-5 md:w-6 md:h-6 text-green-600 dark:text-green-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:D.length}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",children:"Active Courses"})]})]})})}),e.jsx(o,{className:"hover:shadow-md transition-shadow sm:col-span-2 lg:col-span-1",children:e.jsx(c,{className:"p-5 md:p-6",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:"p-2.5 md:p-3 bg-purple-100 dark:bg-purple-900 rounded-lg flex-shrink-0",children:e.jsx(w,{className:"w-5 h-5 md:w-6 md:h-6 text-indigo-600 dark:text-purple-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-2xl md:text-3xl font-bold",children:[(()=>{const e=E.filter(e=>"number"==typeof e.quizScore).map(e=>e.quizScore);return e.length>0?Math.round(e.reduce((e,s)=>e+s,0)/e.length):0})(),"%"]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",children:"Average Score"})]})]})})})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(m,{type:"text",placeholder:"Search your courses...",value:H,onChange:e=>O(e.target.value),className:"max-w-md"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(x,{value:Z,onValueChange:G,children:[e.jsx(g,{className:"w-40",children:e.jsx(u,{placeholder:"All Subjects"})}),e.jsxs(h,{children:[e.jsx(j,{value:"all",children:"All Subjects"}),Y.map(s=>e.jsx(j,{value:s,children:s},s))]})]}),e.jsxs(x,{value:Q,onValueChange:U,children:[e.jsx(g,{className:"w-40",children:e.jsx(u,{placeholder:"Sort by"})}),e.jsxs(h,{children:[e.jsx(j,{value:"recent",children:"Recently Accessed"}),e.jsx(j,{value:"progress",children:"Progress"}),e.jsx(j,{value:"title",children:"Title (A-Z)"})]})]})]})]}),0===X().length?e.jsx(o,{className:"p-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:0===P.length?"No enrolled courses yet":"No courses found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:0===P.length?"Purchase courses to start your learning journey":H||"all"!==Z?"Try adjusting your filters":"Start learning by exploring available subjects"}),e.jsx(r,{onClick:()=>L("/browse"),children:"Browse Courses"})]})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:X().map((s,t)=>e.jsxs(o,{className:"group hover:shadow-lg transition-all cursor-pointer overflow-hidden",onClick:()=>{const e=s.subject.toLowerCase().replace(/\s+/g,"-"),t=s.term?s.term.toLowerCase().replace(/\s+/g,"-"):"";L(`/subject/${e}?grade=${s.grade}${t?`&term=${t}`:""}`)},children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-indigo-500 via-blue-500 to-cyan-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(b,{className:"w-12 h-12 text-white opacity-80"})}),100===s.progress&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(d,{className:"bg-green-500",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Completed"]})})]}),e.jsxs(c,{className:"p-5",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-base mb-1 group-hover:text-indigo-600 transition-colors",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Grade ",s.grade,s.term&&` â€¢ ${s.term}`]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("span",{className:"text-xs font-semibold text-muted-foreground",children:[s.progress,"% complete"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.lessonsCompleted,"/",s.lessonsTotal," lessons"]})]}),e.jsx(i,{value:s.progress,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-xs text-muted-foreground",children:[s.lastAccessed&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsx("span",{children:(()=>{const e=(new Date).getTime()-s.lastAccessed.getTime(),t=Math.floor(e/864e5);return 0===t?"Today":1===t?"Yesterday":`${t}d ago`})()})]}),"number"==typeof s.averageScore&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.averageScore,"% avg"]})]})]}),s.nextLesson&&e.jsxs(r,{onClick:e=>{e.stopPropagation();const t=s.subject.toLowerCase().replace(/\s+/g,"-");L(`/grade/${s.grade}/${t}/lesson/${s.nextLesson.id}`)},className:"w-full gap-2",size:"sm",children:[e.jsx(C,{className:"w-4 h-4"}),s.progress>0?"Continue Learning":"Start Course"]})]})]},t))})]})]})};export{A as default};
