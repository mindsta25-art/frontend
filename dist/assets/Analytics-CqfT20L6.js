import{j as e}from"./ui-BFkRrjhf.js";import{r as s}from"./vendor-ClsjX3Mm.js";import{C as t,b as a,c as i,a as n,d as c}from"./card-COhXL4y3.js";import{T as r,a as l,b as d,c as o}from"./tabs-C0D04NFg.js";import{P as m}from"./progress-BCMZ4yGb.js";import{u as x,L as j,B as h}from"./index-CgruMJ9X.js";import{B as u}from"./badge-CO1u2g-4.js";import{S as v,a as p,b as y,c as f,d as g}from"./select-BhEU0EIQ.js";import{c as N,e as b}from"./analytics-jhJgQtef.js";import{A as w}from"./AdminLayout-BWmn8TIL.js";import{R as A,ad as S,U as L,t as U,B as C,A as R}from"./icons-Udnp6KR8.js";import"./charts-DeubIqjP.js";import"./scroll-area-DkFg0wM_.js";const D=()=>{const[D,k]=s.useState(null),[M,P]=s.useState(!0),[O,T]=s.useState("30"),{toast:z}=x(),E=async()=>{P(!0);try{const e=new Date,s=new Date;s.setDate(s.getDate()-parseInt(O));const t=await N({startDate:s.toISOString(),endDate:e.toISOString()});k(t||{gradeDistribution:[],userGrowth:[],lessonCompletions:[],engagementMetrics:{avgTimePerLesson:0,completionRate:0,quizAccuracy:0,activeUsers:0,peakActivityHour:0,totalSessions:0},activityPatterns:{dailyActive:0,weeklyActive:0,monthlyActive:0,avgSessionDuration:0,retentionRate:0}})}catch(e){z({title:"Error",description:"Failed to load analytics data. Using default values.",variant:"destructive"}),k({gradeDistribution:[],userGrowth:[],lessonCompletions:[],engagementMetrics:{avgTimePerLesson:0,completionRate:0,quizAccuracy:0,activeUsers:0,peakActivityHour:0,totalSessions:0},activityPatterns:{dailyActive:0,weeklyActive:0,monthlyActive:0,avgSessionDuration:0,retentionRate:0}})}finally{P(!1)}};s.useEffect(()=>{E()},[O]);const G=async e=>{try{const s=await b(e,"all");if("csv"===e){const e=new Blob([s],{type:"text/csv"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`analytics-export-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}else{const e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`analytics-export-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}z({title:"Success",description:`Analytics exported as ${e.toUpperCase()}`})}catch(s){z({title:"Error",description:"Failed to export analytics",variant:"destructive"})}};if(M)return e.jsx(j,{message:"Loading analytics dashboard..."});if(!D)return e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No analytics data available"}),e.jsx(h,{onClick:E,className:"mt-4",children:"Try Again"})]})})});const B=Math.max(...D.gradeDistribution.map(e=>e.students),1),I=Math.max(...D.lessonCompletions.map(e=>e.completions),1),$=Math.max(...D.userGrowth.map(e=>e.users),1);return e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Real-time platform insights and metrics"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(v,{value:O,onValueChange:T,children:[e.jsx(p,{className:"w-40",children:e.jsx(y,{placeholder:"Select range"})}),e.jsxs(f,{children:[e.jsx(g,{value:"7",children:"Last 7 days"}),e.jsx(g,{value:"30",children:"Last 30 days"}),e.jsx(g,{value:"90",children:"Last 90 days"}),e.jsx(g,{value:"180",children:"Last 6 months"})]})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:E,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>G("csv"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>G("json"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Export JSON"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Active Users"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:D.engagementMetrics.activeUsers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Last ",O," days"]})]})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Avg Time / Lesson"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[D.engagementMetrics.avgTimePerLesson," min"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average session duration"})]})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Completion Rate"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[D.engagementMetrics.completionRate,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Lessons completed"}),e.jsx(m,{value:D.engagementMetrics.completionRate,className:"mt-2"})]})]}),e.jsxs(t,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Quiz Accuracy"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[D.engagementMetrics.quizAccuracy,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average score"})]})]})]}),e.jsxs(r,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(d,{value:"overview",children:"Overview"}),e.jsx(d,{value:"students",children:"Student Analytics"}),e.jsx(d,{value:"content",children:"Content Performance"})]}),e.jsx(o,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(t,{children:[e.jsxs(a,{children:[e.jsx(i,{children:"User Growth Trend"}),e.jsx(c,{children:"New registrations over time"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:D.userGrowth.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:[s.month," ",s.year]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.users," users"]})]}),e.jsx(m,{value:s.users/$*100})]},`${s.month}-${s.year}`))})})]}),e.jsxs(t,{children:[e.jsxs(a,{children:[e.jsx(i,{children:"Student Distribution by Grade"}),e.jsx(c,{children:"Current enrollment across grades"})]}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:D.gradeDistribution.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Grade ",s.grade]}),e.jsxs(u,{variant:"secondary",children:[s.students," students"]})]}),e.jsx(m,{value:s.students/B*100})]},s.grade))})})]})]})}),e.jsx(o,{value:"students",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(a,{children:[e.jsx(i,{children:"Activity Patterns"}),e.jsx(c,{children:"User engagement breakdown"})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm",children:"Daily Active"}),e.jsx("span",{className:"font-bold",children:D.activityPatterns.dailyActive})]}),e.jsx(m,{value:D.activityPatterns.dailyActive/D.engagementMetrics.activeUsers*100})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm",children:"Weekly Active"}),e.jsx("span",{className:"font-bold",children:D.activityPatterns.weeklyActive})]}),e.jsx(m,{value:D.activityPatterns.weeklyActive/D.engagementMetrics.activeUsers*100})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm",children:"Monthly Active"}),e.jsx("span",{className:"font-bold",children:D.activityPatterns.monthlyActive})]}),e.jsx(m,{value:D.activityPatterns.monthlyActive/D.engagementMetrics.activeUsers*100})]})]})})]})}),e.jsx(o,{value:"content",className:"space-y-4",children:e.jsxs(t,{children:[e.jsxs(a,{children:[e.jsx(i,{children:"Top Performing Lessons"}),e.jsx(c,{children:"Most completed lessons by subject"})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-3",children:[D.lessonCompletions.map((s,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.subject}),e.jsxs(u,{variant:"outline",children:[s.completions," completions"]})]}),e.jsx(m,{value:s.completions/I*100})]},t)),0===D.lessonCompletions.length&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No lesson completion data available"})]})})]})})]})]})})};export{D as default};
